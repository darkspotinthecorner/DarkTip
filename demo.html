<!DOCTYPE html>
<html>
<head>
	<title>DarkTip Demo</title>
	<script src="dist/darktip.js" type="text/javascript"></script>
</head>
<body>
	<h1>Loaded</h1>
	<div id="output"></div>
	<script type="text/javascript" charset="utf-8">

		DarkTip.triggerGroup('implicit').event('a[href]', 'hover', function(elem) { return elem.getAttribute('href'); });
		DarkTip.triggerGroup('explicit').event('[data-darktip]', 'hover', function(elem) { return elem.getAttribute('data-darktip'); });

		DarkTip.module('github')
			.map('root_url', '(?:https?://)?(?:www\.)?github\.com/')
			.template('foo', '<i>BAZ</i>');

		DarkTip.module('github-user', 'github')
			.trigger('implicit', '^{module.map.root_url}([^/]+)/?$', {1: 'username'})
			.apicall('user', '//api.github.com/users/{username}', (60 * 60 * 24 * 1), function(data) { return (data.meta.status == 200); }, function(data) { return (data.data); })
			.apicall('user-repos', '//api.github.com/users/{username}/repos', (60 * 60 * 24 * 1), function(data) { return (data.meta.status == 200); }, function(data) { return (data.data); })
			.template('index', 'Hallo Github user, {username}! {>foo /}')
			.template('foo', '<i>bar</i>')
			.template('narf', '{@api query="user:github-user|repos:github-user-repos"}User found: {#user.name}{.} {/user.name}"{user.login}" ({user.id}){?repos}<h2>Repositories:</h2>{#repos}<br/>{full_name}{/repos}{/repos}{:else}github user apicall failed for "{user.username}"{/api}');

		DarkTip.module('github-repository', 'github')
			.trigger('implicit', '^{module.map.root_url}([^/]+)/([^/]+)/?$', {1: 'username', 2: 'repository'});

		DarkTip.dust.register('index', DarkTip.dust.loadSource(DarkTip.dust.compile('Hallo Github user, {username}', 'index')));

		var buildDemoCallbackFn = function(label) {
			return function(err, out)
			{
				if (err) {
					console.log({'error': err, 'stacktrace': err.stack});
				} else {
					var container = document.querySelector('#output');
					container.innerHTML = container.innerHTML + '<pre class="output"><h3>' + label + '</h3><div class="content">' + out + '</div></pre>';
				}
			}
		}

		var narf = buildDemoCallbackFn('github-user test');
		console.log(narf);

		DarkTip.module('github-user').test({'username': 'darkspotinthecorner'}, narf);

		var formatJSON = function(json) {
			return '<pre>'+(json.replace(/(\})/ig, "$1\r\n").replace(/(\{)/g, "\r\n$1"))+'</pre>';
		}

		/*
		var mod_wow = DarkTip.module('wow');
		var mod_wow2 = DarkTip.module('wow2', 'wow');

		console.log('setting wow.setting.aaa to "999"');
		mod_wow.setting('aaa', 999);
		console.log('setting wow.setting.bbb.b to "111"');
		mod_wow.setting('bbb.a', 111);
		console.log('setting wow.setting.bbb.b to "222"');
		mod_wow.setting('bbb.b', 222);
		console.log('setting wow.setting.bbb.b to "333"');
		mod_wow.setting('bbb.c', 333);

		console.log({'wow2.setting.bbb.b' : DarkTip.module('wow2').setting('bbb.b')});

		console.log('setting wow2.setting.bbb.b to "888"');
		mod_wow2.setting('bbb.b', 888);

		console.log({'wow2.setting.bbb.c' : DarkTip.module('wow2').setting('bbb.c')});
		console.log({'wow2.setting.bbb.b' : DarkTip.module('wow2').setting('bbb.b')});

		console.log('setting wow2.setting.bbb.b.a to "777"');
		mod_wow2.setting('bbb.b.a', 777);

		console.log({'wow2.setting.bbb.b' : DarkTip.module('wow2').setting('bbb.b')});
		console.log({'wow2.setting.bbb.b.a' : DarkTip.module('wow2').setting('bbb.b.a')});
		// */

	</script>
</body>
</html>