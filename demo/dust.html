<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Dust tests</title>
	<style type="text/css" media="screen">
		body {
			font-family: Helvetica, sans-serif;
		}
		#output {
			border: 3px solid #bbb;
		}
		#output .output {
			border-top: 3px solid #bbb;
		}
		#output .content {
			padding: 10px;
		}
		#output .output:nth-child(1) {
			border-top: 0;
		}
		#output .output h1 {
			font-size: 1.2em;
			background-color: #ddd;
			margin: 0;
			padding: 5px 10px;
		}
	</style>
</head>
<body>
	<p>
		Lorem ipsum dolor sit amet, <a href="http://www.google.de">consectetur adipisicing</a> elit. Voluptates esse unde doloribus, <a href="http://www.github.com">alias enim magnam ipsum</a> sequi, quisquam fuga laudantium quidem tempora veniam velit fugiat possimus! Sit quae commodi ipsum.
	</p>
	<div id="output"></div>

	<script src="../vendor/q/q.js" type="text/javascript" charset="utf-8"></script>
	<script src="../vendor/dustjs/dust-full.js" type="text/javascript" charset="utf-8"></script>
	<script src="../vendor/dustjs-helpers/dust-helpers.js" type="text/javascript" charset="utf-8"></script>
	<script src="../src/v2/main.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" charset="utf-8">

		DarkTip.triggerGroup('implicit').event('a[href]', 'hover', function(elem) { return elem.getAttribute('href'); });
		//DarkTip.triggerGroup('explicit').event('[data-darktip]', 'hover', function(elem) { return elem.getAttribute('data-darktip'); });

		DarkTip.module('github-user')
			.apicall('user');

		var i18n = {
			'en_US': {
				'salutation': 'Hi threre, {name}! How are you?'
			},
			'de_DE': {
				'salutation': 'Hallo {name}, wie geht\'s denn so?'
			}
		};

		dust.helpers.i18n.context(i18n['de_DE']);

		var data = {
			'usewhat': 'salutation',
			'_i18n_': {
				'salutation': 'this should not show'
			},
			'name': 'Fred',
			'test': 'B',
			'username': 'darkspotinthecorner',
			'othername': 'rragan',
			'users': [
				{ 'name': 'Wilma',  'bar': 'one',   'narf': '111'},
				{ 'name': 'Barney', 'bar': 'two',   'narf': '222'},
				{ 'name': 'Dino',   'bar': 'three', 'narf': '333'},
			],
			'xxx': 'testing'
		};

		var buildDemoCallbackFn = function(label) {
			return function(err, out)
			{
				if (err) {
					console.log({'error': err, 'stacktrace': err.stack});
				} else {
					var container = document.querySelector('#output');
					container.innerHTML = container.innerHTML + '<div class="output"><h1>' + label + '</h1><div class="content">' + out + '</div></div>';
				}
			}
		}

		dust.loadSource(dust.compile('{#users blubb="aaa_{test}"}{@i18n t="{usewhat}"/}{@sep}<hr />{/sep}{/users}', 'test_i18n_1'));
		dust.render('test_i18n_1', data, buildDemoCallbackFn('test_i18n_1'));

		dust.loadSource(dust.compile('<a href="http://www.heise.de">{@i18n t="salutation" name="github_{username}"/}</a>', 'test_i18n_2'));
		dust.render('test_i18n_2', data, buildDemoCallbackFn('test_i18n_2'));

		dust.loadSource(dust.compile('{@api query="user:github-user|repos:github-user-repos"}User found: {#user.name}{.} {/user.name}"{user.login}" ({user.id}){?repos}<h2>Repositories:</h2>{#repos}<br/>{full_name}{/repos}{/repos}{:else}github user apicall failed for "{user.username}"{/api}', 'test_apiquery_1'));
		dust.render('test_apiquery_1', data, buildDemoCallbackFn('test_apiquery_1'));

		var ctx = dust.makeBase()
			.push({'aaa': 'one', 'bbb': 'two', 'ccc': {'aa': 'three', 'bb': 'four'}})
			.push({'aaa': 'super', 'ddd': 'narf'});
		// console.log(['context.get(aaa)', ctx.get('aaa')]);

		setTimeout(function() {
			var e = document.querySelector('#foobar');
			var link = document.createElement('a');
			link.href  = 'http://www.dsitc.de';
			link.innerHTML = 'TEEEEEST';
			var container = document.querySelector('#foobar');
			container.insertBefore(link, container.lastChild);
		}, 1000);

	</script>
	<div id="foobar"><hr /></div>
</body>
</html>